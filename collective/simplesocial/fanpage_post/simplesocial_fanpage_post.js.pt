var fanpage_post_callback = fanpage_post_callback || function (response) {};

(function($){
  $(function() {
    var docac = $('.documentActions ul');
    if (!docac.length) {
        docac = $('<ul></ul>').appendTo('.documentActions');
    }
    var actor_id = <tal:block tal:replace="view/actor_id"/>;
    if (!actor_id) return;
    
    function simplesocial_pagePublish(attach) {
        FB.ui({
                method: 'stream.publish',
                attachment: attach,
                actor_id: actor_id
            },
            fanpage_post_callback
        );
    }
    
    $('<li><a href="#">Post to Fan Page</a></li>')
        .click(function(e) {
            e.preventDefault();
            $.getJSON(window.location.href + '/@@simplesocial_attachment', null, function(attach) {
                 simplesocial_queue.push(function () {
                     FB.getLoginStatus(function(response) {
                         if (response.session) {
                             simplesocial_pagePublish();
                         } else {
                             FB.login(function (response) {
                                 simplesocial_pagePublish();
                             });
                         }
                     });
                 });
            });
        })
        .appendTo(docac);
  });
})(jQuery);
